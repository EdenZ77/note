# go get 命令

`go get` 命令用于下载和更新代码包及其依赖项。它的行为会根据使用的 Go 版本和是否使用 Go Modules 而有所不同。

## 使用 Go Modules（Go 1.11 及以后版本）
当项目使用 Go Modules 时（即存在 `go.mod` 文件），`go get` 的行为如下：
- 下载指定的包及其依赖到本地模块缓存中。
- 更新 `go.mod` 和 `go.sum` 文件以反映新的依赖版本。

**模块缓存位置**：
- 在使用 Go Modules 模式时，下载的依赖包会保存在本地模块缓存中，路径如下：
  - **Linux/macOS**：`$GOPATH/pkg/mod`
  - **Windows**：`%GOPATH%\pkg\mod`

## 使用 $GOPATH 模式（Go 1.11 以前版本或未启用 Go Modules）
在未启用 Go Modules 的情况下，`go get` 会下载包到 `$GOPATH` 指定的工作空间中。

- `go get` 会将下载的包保存在 `$GOPATH/src` 目录中：
  - **Linux/macOS**：`$GOPATH/src`
  - **Windows**：`%GOPATH%\src`

# go install 命令
`go install` 命令用于编译和安装可执行文件。它会根据当前模块模式决定文件的保存位置。

## 使用 Go Modules
在使用 Go Modules 的情况下，`go install` 的行为如下：
- 编译源代码并将生成的可执行文件安装到 `$GOPATH/bin` 目录中。
- 如果没有设置 `GOPATH`，则默认安装路径为：
  - **Linux/macOS**：`$HOME/go/bin`
  - **Windows**：`%USERPROFILE%\go\bin`

## 使用 $GOPATH 模式
在未启用 Go Modules 的情况下，`go install` 的行为如下：
- 在 `$GOPATH/src` 目录中找到源代码并进行编译。
- 将生成的可执行文件安装到 `$GOPATH/bin` 目录中：
  - **Linux/macOS**：`$GOPATH/bin`
  - **Windows**：`%GOPATH%\bin`
- 如果没有设置 `GOPATH`，则默认安装路径为：
  - **Linux/macOS**：`$HOME/go/bin`
  - **Windows**：`%USERPROFILE%\go\bin`

## 示例

使用 `go install` 的基本语法

```sh
go install [build flags] [packages]
```

参数和选项

- **`[build flags]`**：可选的构建标志，如 `-v`（显示详细信息）、`-x`（显示执行的命令）等。
- **`[packages]`**：要安装的包，可以是当前目录、相对路径或者绝对路径的包目录。

### 示例

#### 1. 安装当前包的可执行文件
假设当前目录是一个可执行文件的 Go 包，可以直接运行：
```sh
go install
go install ./cmd/mytool # 使用相对路径安装指定的包
```

#### 2. 安装指定包路径的可执行文件
可以为 `go install` 指定一个包路径，例如：
```sh
go install github.com/user/project/cmd/tool
```

#### 3. 使用构建标志
可以传递构建标志以控制构建过程：
```sh
go install -v github.com/user/project/cmd/tool
```

### 环境变量和安装路径

#### `GOBIN`
`GOBIN` 环境变量指定了可执行文件安装的目录。如果未设置，默认安装路径为 `$GOPATH/bin`。

```sh
# 设置 GOBIN 环境变量
export GOBIN=/path/to/custom/bin

# 安装工具
go install github.com/user/project/cmd/tool
```

#### `GOPATH` 和 `GOBIN`
如果未设置 `GOBIN`，`go install` 将使用 `GOPATH/bin` 作为默认安装路径。

```sh
# 默认情况下安装到 $GOPATH/bin
go install github.com/user/project/cmd/tool
```

### 示例项目结构
假设有以下项目结构：

```
myproject/
├── cmd/
│   └── mytool/
│       └── main.go
├── go.mod
└── go.sum
```

`main.go` 文件内容如下：

```go
package main

import "fmt"

func main() {
    fmt.Println("Hello, World!")
}
```

#### 使用 `go install` 安装 `mytool`
1. 确保你在项目根目录（包含 `go.mod` 文件）中。
2. 运行以下命令安装 `mytool`：
    ```sh
    go install ./cmd/mytool
    ```

3. 可执行文件 `mytool` 将被安装到 `$GOPATH/bin` 或 `GOBIN` 目录中。

# go build 命令

`go build` 命令用于编译指定的源代码文件或包，但不会安装生成的可执行文件或库。它会在当前目录或指定目录中生成可执行文件（或库文件）。

**基本语法**

```sh
go build [build flags] [packages]
```

**常见用法**

1. **编译当前目录下的包**：
    ```sh
    go build
    ```
    这将在当前目录下生成一个可执行文件（通常与目录同名）。

2. **编译指定包**：
    ```sh
    go build ./cmd/mytool
    ```
    这将在当前目录下生成 `mytool` 可执行文件。

3. **编译并指定输出文件名**：
    ```sh
    go build -o mybinary ./cmd/mytool
    ```
    这将在当前目录下生成 `mybinary` 可执行文件。

4. **交叉编译**（生成不同平台的可执行文件）：
    ```sh
    GOOS=linux GOARCH=amd64 go build -o mybinary_linux ./cmd/mytool
    ```
    这将在当前目录下生成一个适用于 Linux 平台的 `mybinary_linux` 可执行文件。

5. **使用构建标志**：
    ```sh
    go build -v -x ./cmd/mytool
    ```
    - `-v`：显示正在编译的包。
    - `-x`：显示执行的命令。



2. **安装指定包**：
    ```sh
    go install ./cmd/mytool
    ```

3. **使用构建标志**：
    ```sh
    go install -v ./cmd/mytool
    ```

### `go build` 和 `go install` 的区别

#### 生成文件位置
- **`go build`**：生成的可执行文件（或库）通常保存在当前目录或指定目录中。
- **`go install`**：生成的可执行文件（或库）保存在 `$GOBIN`（如果设置的话）或者 `$GOPATH/bin` 目录中。

#### 使用场景
- **`go build`**：常用于本地开发和测试，生成可执行文件以便在当前目录下运行或调试，不会污染全局的 `bin` 目录。
- **`go install`**：用于将可执行文件（或库）安装到全局可执行路径，便于在命令行中直接执行，适合在 CI/CD 环境中使用。

#### 示例对比
假设有以下项目结构：

```
myproject/
├── cmd/
│   └── mytool/
│       └── main.go
├── go.mod
└── go.sum
```

`main.go` 文件内容如下：

```go
package main

import "fmt"

func main() {
    fmt.Println("Hello, World!")
}
```

- **使用 `go build` 编译 `mytool`**：
    ```sh
    cd myproject
    go build ./cmd/mytool
    ```
    结果：在 `myproject` 目录下生成 `mytool` 可执行文件。

- **使用 `go install` 安装 `mytool`**：
    ```sh
    cd myproject
    go install ./cmd/mytool
    ```
    结果：在 `$GOBIN` 或 `$GOPATH/bin` 目录下生成 `mytool` 可执行文件。

### 总结
- **`go build`**：用于本地编译，生成可执行文件或库文件，通常保存在当前目录。适合开发和测试。
- **`go install`**：用于编译并安装可执行文件或库文件，安装到全局路径（`$GOBIN` 或 `$GOPATH/bin`）。适合部署和发布。

通过理解 `go build` 和 `go install` 的区别和使用场景，你可以更灵活地管理和构建 Go 项目，提高开发效率。