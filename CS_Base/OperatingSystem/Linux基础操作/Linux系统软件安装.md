# Linux软件包（源码包和二进制包）

## Linux源码包

实际上，源码包就是一大堆源代码程序，是由程序员按照特定的格式和语法编写出来的。我们都知道，计算机只能识别机器语言，也就是二进制语言，所以源码包的安装需要一名“翻译官”将“abcd”翻译成二进制语言，这名“翻译官”通常被称为编译器。  

虽然源码包免费开源，但用户不会编程怎么办？一大堆源代码程序不会使用怎么办？源码包容易安装吗？等等这些都是使用源码包安装方式无法解答的问题。

另外，由于源码包的安装需要把源代码编译为二进制代码，因此安装时间较长。比如，大家应该都在 Windows 下安装过 QQ， QQ 功能较多，程序相对较大（有 70 MB 左右），但由于其并非是以源码包的形式发布，而是编译后才发布的，因此只需几分钟（经过简单的配置）即可安装成功。但如果我们以源码包安装的方式在 Linux 中安装一个 MySQL 数据库，即便此软件的压缩包仅有 23 MB 左右，也需要 30 分钟左右的时间（根据硬件配置不同，略有差异）。  

为了解决使用源码包安装方式的这些问题， Linux 软件包的安装出现了使用二进制包的安装方式。  

## Linux二进制包

二进制包，也就是源码包经过成功编译之后产生的包。由于二进制包在发布之前就已经完成了编译的工作，因此用户安装软件的速度较快（同 Windows 下安装软件速度相当），且安装过程报错几率大大减小。

二进制包是 Linux 下默认的软件安装包，因此二进制包又被称为默认安装软件包。目前主要有以下 2 大主流的二进制包管理系统：  

- dpkg： 这个机制最早是由 Debian Linux 社群所开发出来的，通过 dpkg 的机制， Debian 提供的软件就能够简单的安装起来，同时还能提供安装后的软件信息，实在非常不错。 只要是衍生于 Debian 的其他 Linux distributions 大多使用 dpkg 这个机制来管理软件的， 包括 B2D, Ubuntu 等等。
- RPM： 这个机制最早是由 Red Hat 这家公司开发出来的，后来实在很好用，因此很多 distributions 就使用这个机制来作为软件安装的管理方式。包括 Fedora, CentOS, SuSE 等等知名的开发商都是用这个。

## 源码包 VS RPM二进制包

源码包一般包含多个文件，为了方便发布，通常会将源码包做打包压缩处理， Linux 中最常用的打包压缩格式为“tar.gz”，因此源码包又被称为 Tarball。  

。。。。。。



## RPM包安装、卸载和升级

![image-20240701151852525](image/image-20240701151852525.png)

RPM 软件包的安装与卸载要考虑包之间的依赖性。 否则会报错。  

RPM 软件包的卸载很简单，使用如下命令即可：  

```
[root@localhost ~]# rpm -e 包名
```

-e 选项表示卸载，也就是 erase 的首字母。  

RPM 软件包的卸载命令支持使用“-nocteps”选项，即可以不检测依赖性直接卸载，但此方式不推荐大家使用，因为此操作很可能导致其他软件也无法正常使用。  

## RPM查询

rpm 命令还可用来对 RPM 软件包做查询操作，具体包括：

- 查询软件包是否已安装；`rpm -q 包名`  
- 查询系统中所有已安装的软件包；`rpm -qa`  
- 查看软件包的详细信息；`rpm -qi 包名`  
- 查询软件包的文件列表；`rpm -ql 包名`  
- 查询某系统文件具体属于哪个 RPM 包。  `rpm -qf 系统文件名`  

## RPM包的依赖性及其解决方案

RPM 软件包（包含 SRPM 包）的依赖性主要体现在 RPM 包安装与卸载的过程中。

例如，如果采用最基础的方式安装 Linux 系统，则 gcc 这个软件是没有安装的，需要自己手工安装。当你使用rpm 命令安装 gcc 软件的 RPM 包，就会发生依赖性错误，错误提示信息如下所示：  

```sh
[root@localhost ~]# rpm -ivh /mnt/cdrom/Packages/gcc-4.4.6-4.el6.i686.rpm
error: Failed dependencies: <―依赖性错误
cloog-ppi >= 0.15 is needed by gcc-4.4.6-4.el6.i686
cpp = 4.4.6-4.el6 is needed by gcc-4.4.6-4.el6.i686
glibc-devel >= 2.2.90-12 is needed by gcc-4.4.6-4.el6.i686
```

yum，全称“Yellow dog Updater, Modified”，是一个专门为了解决包的依赖关系而存在的软件包管理器。  

可以这么说， yum 是改进型的 RPM 软件管理器，它很好的解决了 RPM 所面临的软件包依赖问题。 yum 在服务器端存有所有的 RPM包，并将各个包之间的依赖关系记录在文件中，当管理员使用 yum 安装 RPM 包时， yum 会先从服务器端下载包的依赖性文件，通过分析此文件从服务器端一次性下载所有相关的 RPM 包并进行安装。  

使用 yum 安装软件包之前，需指定好 yum 下载 RPM 包的位置，此位置称为 yum 源。换句话说， yum 源指的就是软件安装包的来源。  

## yum 命令详解

查询命令：

- yum list：查询所有已安装的软件包
- yum list 包名：查询软件包的安装情况
- yum search 关键字：从 yum 源服务器上查找与关键字相关的所有软件包

- yum info 包名：查询软件包的详细信息

安装命令：yum -y install 包名

升级命令：yum -y update 包名

卸载命令：yum remove 包名
使用 yum 卸载软件包时，会同时卸载所有与该包有依赖关系的其他软件包，即便有依赖包属于系统运行必备文件，也会被 yum 无情卸载，带来的直接后果就是使系统崩溃。

## 源码包安装和卸载教程

Linux 系统中，绝大多数软件的源代码都是用 C 语言编写的，少部分用 C++（或其他语言）编写。因此要想安装源码包，必须安装 gcc 编译器（如果涉及 C++ 源码程序，还需要安装 gcc-c++）。  

除了安装编译器，还需要安装 make 编译命令。要知道，编译源码包可不像编译一个 hello.c 文件那样轻松，包中含大量的源码文件，且文件之间有着非常复杂的关联，直接决定着各文件编译的先后顺序，因此手动编译费时费力，而使用 make 命令可以完成对源码包的自动编译。  

本节仍然以安装 apache 为例，安装过程分为如下几步：  

1、下载 apache 源码包。该软件的源码包可通过官方网站下载，得到的源码包格式为压缩包（ ".tar.gz" 或 ".tar.bz2" ）。  

将各种文件分门别类保存在对应的目录中，应该成为合格 Linux 管理员约定俗成的习惯。 Linux 系统中用于保存源代码的位置主要有 2个，分别是 "/usr/src" 和 "/usr/local/src"，其中 "/usr/src" 用来保存内核源代码， "/usr/local/src" 用来保存用户下载的源代码。  

2、将源码包进行解压缩，使用命令如下：  

```shell
[root@localhost ~]# tar -zxvf httpd-2.2.9.tar.gz | more
```

3、进入解压目录，执行如下命令：  

```shell
[root@localhost ~]# cd httpd-2.2.9
```

4、./configure 软件配置与检查。这一步主要完成以下 3 项任务：  

- 检测系统环境是否符合安装要求
- 定义需要的功能选项。通过 "./configure --prefix=安装路径" 可以指定安装路径。
  注意， configure 不是系统命令，而是源码包软件自带的一个脚本程序，所以必须采用 "./configure" 方式执行（ "./" 代表在当前目录下）。 "./configure" 支持的功能选项较多，可执行 "./configure --help" 命令查询其支持的功能。
- 把系统环境的检测结果和定义好的功能选项写入 Makefile 文件，因为后续的编译和安装需要依赖这个文件的内容。  


```shell
[root@localhost httpd-2.2.9]# ./configure --prefix=/usr/local/apache2
checking for chosen layout...Apache
。。。
```

5、make 编译。 make 会调用 gcc 编译器，并读取 Makefile 文件中的信息进行软件编译。编译的目的就是把源码程序转变为能被Linux 识别的可执行文件，这些可执行文件保存在当前目录下。  

```shell
[root@localhost httpd-2.2.9]# make
```

编程过程较为耗时，需要有足够的耐心。  

6、正式开始安装软件，这里通常会写清程序的安装位置，如果没有，则建议读者把安装的执行过程保存下来，以备将来删除软件时使用。安装指令如下：  

```shell
[root@localhost httpd-2.2.9]# make install
```

整个过程不报错，即为安装成功。  安装源码包过程中，如果出现“error”（或“warning”）且安装过程停止，表示安装失败；反之，如果仅出现警告信息，但安装过程还在继续，这并不是安装失败，顶多使软件部分功能无法使用。  

注意，如果在 "./configure" 或 "make" 编译中报错，则在重新执行命令前一定要执行 make clean 命令，它会清空 Makefile 文件或编译产生的 ".o" 文件。  

**源码包卸载**

通过源码包方式安装的各个软件，其安装文件独自保存在 /usr/local/ 目录下的各子目录中。例如， apache 所有的安装文件都保存在/usr/local/apache2 目录下。这就为源码包的卸载提供了便利。  

源码包的卸载，只需要找到软件的安装位置，直接删除所在目录即可，不会遗留任何垃圾文件。需要读者注意的是，在删除软件之前，应先将软件停止服务。  