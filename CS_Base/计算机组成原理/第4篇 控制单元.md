# 第9章 控制单元的功能

本章结合指令周期的 4 个阶段，着重分析控制单元为完成不同指令所发出的各种操作命令—~这些命令（又称控制信号）控制计算机的所有部件有次序地完成相应的操作，以达到执行程序的目的一旨在使读者进一步理解指令周期、机器周期、时钟周期（节拍）和控制信号的关系，进一步体会控制单元在机器运行中所起到的核心作用，为下一章控制单元的设计打好基础。  



## 9.1 微操作命令的分析

控制单元具有发出各种微操作命令（即控制信号）序列的功能。

概括地说，计算机的功能就是执行程序。在执行程序的过程中，控制单元要发出各种微操作命令，而且不同的指令对应不同的命令。进一步分析发现，完成不同指令的过程中，有些操作是相同或相似的，如取指令、取操作数地址（当间接寻址时）以及进入中断周期由中断隐指令完成的一系列操作。为更清晰起见，下面按指令周期的 4 个阶段进一步分析其对应的微操作命令。

### 取指周期

为了便千讨论，假设 CPU 内有 4 个寄存器，如图 8.10 所示。 MAR 与地址总线相连，存放欲访问的存储单元地址； MDR 与数据总线相连，存放欲写入存储器的信息或最近从存储器中读出的信息； PC 存放现行指令的地址，有计数功能； IR 存放现行指令。取指令的过程可归纳为以下几个操作。

1. 现行指令地址送至存储器地址寄存器，记作 PC--+MAR 。
2. 向主存发送读命令，启动主存做读操作，记作 1--+R 。
3. 将 MAR（通过地址总线）所指的主存单元中的内容（指令）经数据总线读至 MDR 内，记作M(MAR)--+MDR 。
4. 将 MDR 的内容送至 IR ，记作 MDR--+IR 。
5. 指令的操作码送至 CU 译码，记作 OP(IR)--+CU 。
6. 形成下一条指令的地址，记作 (PC)+l--+PC 。  



### 间址周期

间址周期完成取操作数有效地址的任务，具体操作如下。

1. 将指令的地址码部分（形式地址）送至存储器地址寄存器，记作 Ad(IR)--+MAR 。
2. 向主存发送读命令，启动主存做读操作，记作 l--+R 。
3. 将 MAR （通过地址总线）所指的主存单元中的内容（有效地址）经数据总线读至 MDR内，记作 M(MAR)--+MDR 。
4. 将有效地址送至指令寄存器的地址字段，记作 MDR--+Ad(IR) 。此操作在有些机器中可省略。  



### 执行周期

不同指令执行周期的微操作是不同的，下面分别讨论非访存指令、访存指令和转移类指令的微操作。

1、非访存指令
这类指令在执行周期不访问存储器。
(1) 清除累加器指令 CLA
该指令在执行阶段只完成清除累加器操作，记作 0---+ACC 。
(2) 累加器取反指令 COM
该指令在执行阶段只完成累加器内容取反，结果送累加器的操作，记作 ACC---+ACC 。
(3) 算术右移一位指令 SHR
该指令在执行阶段只完成累加器内容算术右移一位的操作，记作 L (ACC) ---+R (ACC),
ACC 。 ---+ACC 。 (ACC 的符号位不变）。
(4) 循环左移一位指令 CSL
该指令在执行阶段只完成累加器内容循环左移一位的操作，记作 R(ACC)---+L (ACC),
ACC 。 -+AC 立（或 p-l(ACC) ）。
(5) 停机指令 STP
计算机中有一个运行标志触发器 G ，当 G=l 时，表示机器运行；当 G=O 时，表示停机。 STP指令在执行阶段只需将运行标志触发器置 “0" ，记作 0---+G 。

2、访存指令
这类指令在执行阶段都需要访问存储器。为简单起见，这里只考虑直接寻址的情况，不考虑其他寻址方式。

(1) 加法指令 ADD X
该指令在执行阶段需要完成累加器内容与对应千主存 X 地址单元的内容相加，结果送累加器的操作，具体如下：

1. 将指令的地址码部分送至存储器地址寄存器，记作 Ad(IR) ---+MAR 。
2. 向主存发读命令，启动主存做读操作，记作 1---+R 。
3. 将 MAR （通过地址总线）所指的主存单元中的内容（操作数）经数据总线读至 MDR 内，记作 M(MAR)-+MDR 。
4. 给 ALU 发送加命令，将 ACC 的内容和 MDR 的内容相加，结果存千 ACC ，记作 (ACC) +(MDR) 一ACC 。

当然，也有的加法指令指定两个寄存器的内容相加，如 “ADD AX,BX" ，该指令在执行阶段无须访存，只需完成 (AX) + (BX)-+AX 的操作。

(2) 存数指令 STA X
该指令在执行阶段需将累加器 ACC 的内容存于主存的 X 地址单元中，具体操作如下：

1. 将指令的地址码部分送至存储器地址寄存器，记作 Ad (IR) -+MAR 。
2. 向主存发写命令，启动主存做写操作，记作 1---+W 。
3. 将累加器内容送至 MDR ，记作 ACC---+MDR 。
4. 将 MDR 的内容（通过数据总线）写入 MAR （通过地址总线）所指的主存单元中，记作MDR---+M(MAR) 。

(3) 取数指令 LDA X
该指令在执行阶段需将主存 X 地址单元的内容取至累加器 ACC 中，具体操作如下：

1. 将指令的地址码部分送至存储器地址寄存器，记作 Ad(IR) ---+MAR 。
2. 向主存发读命令，启动主存作读操作，记作 1---+R 。
3. 将 MAR （通过地址总线）所指的主存单元中的内容（操作数）经数据总线读至 MDR 内，记作 M(MAR)-+MDR 。
4. 将 MDR 的内容送至 ACC ，记作 MDR---+ACC 。

3、转移类指令
这类指令在执行阶段也不访问存储器。

(1) 无条件转移指令 JMP X
该指令在执行阶段完成将指令的地址码部分 X 送至 PC 的操作，记作 Ad(IR)-+PC 。

(2) 条件转移（负则转）指令 BAN X
该指令根据上一条指令运行的结果决定下一条指令的地址，若结果为负（累加器最高位为
l ，即 A 。＝ l) ，则指令的地址码送至 PC ，否则程序按原顺序执行。由于在取指阶段已完成了 (PC)1---+ PC ，所以当累加器结果不为负（即 A。 =0) 时，就按取指阶段形成的 PC 执行，记作A 。 .Ad(IR) ＋＼。.（ PC)-+PC 。

由此可见，不同指令在执行阶段所完成的操作是不同的。如果将访存指令分为直接访存和间接访存两种，则上述三类指令的指令周期如图 9.1 所示。

<img src="image/image-20250124181128184.png" alt="image-20250124181128184" style="zoom:50%;" />



### 中断周期

在执行周期结束时刻， CPU 要查询是否有请求中断的事件发生，如果有则进入中断周期。由 8.4.4 节可知，在中断周期，由中断隐指令自动完成保护断点、寻找中断服务程序入口地址以及硬件关中断的操作。假设程序断点存至主存的 0 地址单元，且采用硬件向量法寻找入口地址，则在中断周期需完成如下操作：

1. 将特定地址 “0“ 送至存储器地址寄存器，记作 0-+MAR 。
2. 向主存发写命令，启动存储器作写操作，记作 1-+W 。
3. 将 PC 的内容（程序断点）送至 MDR ，记作 PC-+MDR 。
4. 将 MDR 的内容（程序断点）通过数据总线写入 MAR （通过地址总线）所指示的主存单元(0 地址单元）中，记作 MDR-+M(MAR) 。
5. 将向量地址形成部件的输出送至 PC ，记作向量地址 -+PC ，为下一条指令的取指周期做准备。
6. 关中断，将允许中断触发器清零，记作 0-+EINT （该操作可直接由硬件线路完成，参见图8.30) 。

如果程序断点存入堆栈，而且进栈操作是先修改栈指针，后存入数据（参见图 7.18) ，只需将上述心改为 (SP)-1-+SP ，且 SP-+MAR 。

上述所有操作都是在控制单元发出的控制信号（即微操作命令）控制下完成的。  

## 9.2 控制单元的功能

### 控制单元的外特性

图 9.2 是反映控制单元外特性的框图。  

<img src="image/image-20250124181520811.png" alt="image-20250124181520811" style="zoom:50%;" />

1、输入信号
(1) 时钟
上述各种操作有以下两点应特别注意：

1. 完成每个操作都需占用一定的时间。
2. 各个操作是有先后顺序的。例如，存储器读操作要用到 MAR 中的地址，故 PC-+MAR 应先于 M(MAR)-+MDR 。

为了使控制单元按一定的先后顺序、一定的节奏发出各个控制信号，控制单元必须受时钟控制，即每一个时钟脉冲使控制单元发送一个操作命令，或发送一组需要同时执行的操作命令。

(2) 指令寄存器
现行指令的操作码决定了不同指令在执行周期所需完成的不同操作，故指令的操作码字段是控制单元的输入信号，它与时钟配合可产生不同的控制信号。

(3) 标志
控制单元有时需依赖 CPU 当前所处的状态（如 ALU 操作的结果）产生控制信号，如 BAN 指令，控制单元要根据上条指令的结果是否为负而产生不同的控制信号。因此“标志”也是控制单的输入信号。

(4) 来自系统总线（控制总线）的控制信号
例如，中断请求、 DMA 请求。

2、输出信号
(1) CPU 内的控制信号
主要用于 CPU 内的寄存器之间的传送和控制 ALU 实现不同的操作。

(2) 送至系统总线（控制总线）的信号
例如，命令主存或 I/0 读／写、中断响应等。  



### 控制信号举例

控制单元的主要功能就是能发出各种不同的控制信号。下面以间接寻址的加法指令"ADD @X” 为例，进一步理解控制信号在完成一条指令的过程中所起的作用。

1、不采用 CPU 内部总线的方式

图 9.3 示意了未采用 CPU 内部总线方式的数据通路和控制信号的关系。图中未画出每个寄存器的输入或输出控制门，但标出了控制这些门电路的控制信号 C! ，考虑到从存储器取出的指令或有效地址都先送至 MDR 再送至 IR ，故这里省去了 IR 送至 MAR 的数据通路，凡是需要从IR 送至 MAR 的操作均可由 MDR 送至 MAR 代替。

<img src="image/image-20250124181823646.png" alt="image-20250124181823646" style="zoom:50%;" />

(1) 取指周期

1. 控制信号$C_0$有效，打开 PC 送往 MAR 的控制门。
2. 控制信号$C_1$有效，打开 MAR 送往地址总线的输出门。
3. 通过控制总线向主存发读命令。
4. $C_2$有效，打开数据总线送至 MDR 的输入门。
5. $C_3$有效，打开 MDR 和 IR 之间的控制门，至此指令送至 IR 。
6. $C_4$有效，打开指令操作码送至 CU 的输出门。 CU 在操作码和时钟的控制下，可产生各种控制信号。
7. 使PC内容加1（图中未标出）。

(2) 间址周期

1. $C_5$有效，打开 MDR 和 MAR 之间的控制门，将指令的形式地址送至 MAR 。
2. $C_1$有效，打开 MAR 送往地址总线的输出门。
3. 通过控制总线向主存发读命令。
4. $C_2$立有效，打开数据总线送至 MDR 的输入门，至此，有效地址存入 MDR 。
5. $C_3$有效，打开 MDR 和 IR 之间的控制门，将有效地址送至 IR 的地址码字段。

(3) 执行周期

1. $C_5$有效，打开 MDR 和 MAR 之间的控制门，将有效地址送至 MAR 。
2. 凡有效，打开 MAR 送往地址总线的输出门。
3. 通过控制总线向主存发读命令。
4. $C_2$有效，打开数据总线送至 MDR 的输入门，至此，操作数存入 MDR 。
5. $C_6$、$C_7$同时有效，打开 AC 和 MDR 通往 ALU 的控制门。
6. 通过 CPU 内部控制总线对 ALU 发 “ADD“ 加控制信号，完成 AC 的内容和 MDR 的内容相加。
7. $C_8$有效，打开 ALU 通往 AC 的控制门，至此将求和结果存入 AC 。

图中亿和 ClO 分别是控制 PC 的输出和输入的控制信号， Cu 和 c12 分别是控制 AC 的输出和输入的控制信号。





### 多级时序系统



### 控制方式





### 多级时序系统实例分析





# 第10章 控制单元的设计

## 10.1 组合逻辑设计



## 10.2 微程序设计



